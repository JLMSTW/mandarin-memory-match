<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å¥å­é‡çµ„ï½œMandarin Sentence Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter',system-ui,-apple-system,'Noto Sans TC',sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:24px;color:#fff}
    .container{max-width:1100px;margin:0 auto}
    h1{font-size:2rem;text-align:center;text-shadow:2px 2px 4px rgba(0,0,0,.25)}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:center;margin:16px 0 10px}
    .toolbar select,.toolbar button,.toolbar label{background:#fff;color:#2c3e50;border:none;border-radius:12px;padding:10px 14px;font-weight:700}
    .toolbar button{background:linear-gradient(135deg,#ff9a9e,#fecfef);cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.18)}
    .toolbar input[type="checkbox"]{vertical-align:-2px;margin-right:6px}

    .zones{display:grid;grid-template-columns:1fr;gap:16px;margin-top:8px}
    .zone{min-height:108px;background:rgba(255,255,255,.15);border:2px dashed rgba(255,255,255,.55);
      border-radius:16px;padding:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:flex-start}
    .zone-title{font-weight:800;margin-bottom:6px;opacity:.9}
    .bank{background:rgba(255,255,255,.12)}
    .drop-hover{outline:3px solid #ffe08a}

    .token{user-select:none;cursor:grab;background:#fff;color:#2c3e50;border-radius:12px;padding:8px 10px;
      display:flex;flex-direction:column;align-items:center;gap:4px;box-shadow:0 6px 14px rgba(0,0,0,.2);
      font-weight:800}
    .token:active{cursor:grabbing}
    .hanzi{font-family:'Noto Sans TC',sans-serif;font-size:1.15rem}
    .pinyin{font-size:.85rem;opacity:.85;display:none}
    .show-pinyin .pinyin{display:block}

    .status{margin-top:10px;text-align:center;font-weight:800}
    .status.ok{color:#c8ffb0}
    .status.err{color:#ffe08a}

    @media (min-width:900px){
      .zones{grid-template-columns:1fr 1fr}
      .zone{min-height:140px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§© å¥å­é‡çµ„ï¼ˆæ‹–æ›³æ’åºï¼‰</h1>

    <div class="toolbar">
      <label style="background:transparent;color:#fff;border:none;padding:0">é¡Œç›®ï¼š</label>
      <select id="sentenceSelect" title="é¸æ“‡é¡Œç›®"></select>
      <label><input type="checkbox" id="togglePinyin" />é¡¯ç¤ºæ‹¼éŸ³</label>
      <button id="shuffleBtn">ğŸ”€ é‡æ´—</button>
      <button id="resetBtn">â†©ï¸ é‡ç½®</button>
      <button id="checkBtn">âœ… æª¢æŸ¥ç­”æ¡ˆ</button>
      <button id="nextBtn">â¡ï¸ ä¸‹ä¸€é¡Œ</button>
    </div>

    <div class="zones">
      <div>
        <div class="zone-title">æŠŠè©å¡Šæ‹–åˆ°é€™è£¡ â†’ï¼ˆå¯æ‹–æ›³èª¿æ•´é †åºï¼‰</div>
        <div id="answerZone" class="zone"></div>
      </div>
      <div>
        <div class="zone-title">è©åº«ï¼ˆæ‹–æ›³åˆ°ä¸Šé¢ï¼‰</div>
        <div id="bankZone" class="zone bank"></div>
      </div>
    </div>

    <div id="status" class="status"></div>
  </div>

  <script>
    // å…­å¥é¡Œç›®ï¼šæ¯é¡Œä»¥ã€Œè©å¡Šã€è¨­è¨ˆï¼Œæ¨™é»ä¹Ÿç¨ç«‹ç‚ºè©å¡Šï¼›æä¾›å°æ‡‰æ‹¼éŸ³åšæç¤º
    const DATA = [
      {
        id: 1,
        hanzi: ["å› ç‚º","ä¸€äº›","åŸå› ","ï¼Œ","è£æ½¢","è¦","å†","å»¶","ä¸€å€‹æœˆ","ã€‚"],
        pinyin:["yÄ«n wÃ¨i","yÃ­ xiÄ“","yuÃ¡n yÄ«n","","zhuÄng huÃ¡ng","yÃ o","zÃ i","yÃ¡n","yÃ­ gÃ¨ yuÃ¨",""]
      },
      {
        id: 2,
        hanzi: ["ä½ ","èªªå¾—","å¤ªå¿«","ï¼Œ","è«‹ä½ ","å†","èªª","ä¸€æ¬¡","ï¼"],
        pinyin:["nÇ","shuÅ de","tÃ i kuÃ i","","qÇng nÇ","zÃ i","shuÅ","yÃ­ cÃ¬",""]
      },
      {
        id: 3,
        hanzi: ["é€™å®¶","é¤å»³","å¾ˆ","é“åœ°","ï¼Œ","æˆ‘","å¯ä»¥","å†","å»","å¾ˆå¤šæ¬¡","ã€‚"],
        pinyin:["zhÃ¨ jiÄ","cÄn tÄ«ng","hÄ›n","dÃ o dÃ¬","","wÇ’","kÄ› yÇ","zÃ i","qÃ¹","hÄ›n duÅ cÃ¬",""]
      },
      {
        id: 4,
        hanzi: ["ä½ å€‘","æƒ³è¦","å†","å–","ä¸€æ¯","å•¤é…’","å—","ï¼Ÿ"],
        pinyin:["nÇ men","xiÇng yÃ o","zÃ i","hÄ“","yÃ¬ bÄ“i","pÃ­ jiÇ”","ma",""]
      },
      {
        id: 5,
        hanzi: ["æˆ‘","å·²ç¶“","èªªé","å¾ˆå¤šæ¬¡","äº†","ï¼Œ","æˆ‘","ä¸æƒ³","å†","è§£é‡‹","äº†","ï¼"],
        pinyin:["wÇ’","yÇ jÄ«ng","shuÅ guÃ²","hÄ›n duÅ cÃ¬","le","","wÇ’","bÃ¹ xiÇng","zÃ i","jiÄ› shÃ¬","le",""]
      },
      {
        id: 6,
        hanzi: ["ä»–","é‚„","æ²’å¥½","ï¼Œ","æˆ‘å€‘","è¦","å†","ç­‰","ä»–","äº”åˆ†é˜","ã€‚"],
        pinyin:["tÄ","hÃ¡i","mÃ©i hÇo","","wÇ’ men","yÃ o","zÃ i","dÄ›ng","tÄ","wÇ” fÄ“n zhÅng",""]
      }
    ];

    // ---- DOM å…ƒç´ 
    const answerZone = document.getElementById('answerZone');
    const bankZone = document.getElementById('bankZone');
    const selectEl = document.getElementById('sentenceSelect');
    const togglePinyin = document.getElementById('togglePinyin');
    const statusEl = document.getElementById('status');

    const btnShuffle = document.getElementById('shuffleBtn');
    const btnReset = document.getElementById('resetBtn');
    const btnCheck = document.getElementById('checkBtn');
    const btnNext = document.getElementById('nextBtn');

    // ---- ç‹€æ…‹
    let current = 0;          // ç›®å‰é¡Œç›® index
    let showPinyin = false;   // æ‹¼éŸ³é¡¯ç¤º

    // ---- åˆå§‹åŒ–ä¸‹æ‹‰
    function initSelect(){
      DATA.forEach((q,i)=>{
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = `ç¬¬ ${q.id} é¡Œ`;
        selectEl.appendChild(opt);
      });
    }

    // ---- ç”¢ç”Ÿ token å…ƒç´ 
    function createToken(sentenceIdx, tokenIdx){
      const tId = `${sentenceIdx}-${tokenIdx}`;
      const wrap = document.createElement('div');
      wrap.className = 'token';
      wrap.draggable = true;
      wrap.dataset.tokenId = tId;
      wrap.dataset.hanzi = DATA[sentenceIdx].hanzi[tokenIdx];

      const hz = document.createElement('div');
      hz.className = 'hanzi';
      hz.textContent = DATA[sentenceIdx].hanzi[tokenIdx];

      const py = document.createElement('div');
      py.className = 'pinyin';
      py.textContent = DATA[sentenceIdx].pinyin[tokenIdx];

      wrap.append(hz,py);

      // DnD handlers
      wrap.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('text/plain', tId);
        setTimeout(()=> wrap.style.opacity = '0.6', 0);
      });
      wrap.addEventListener('dragend', ()=> wrap.style.opacity = '1');

      // é›™æ“Šé€å›è©åº«
      wrap.addEventListener('dblclick', ()=>{
        bankZone.appendChild(wrap);
      });

      return wrap;
    }

    function clearZones(){
      answerZone.innerHTML = '';
      bankZone.innerHTML = '';
    }

    // æ´—ç‰Œ
    function shuffle(arr){
      const a = [...arr];
      for (let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    // è¼‰å…¥é¡Œç›®
    function loadSentence(idx, shuffleBank=true){
      current = idx;
      selectEl.value = String(idx);
      statusEl.textContent = '';

      clearZones();
      const { hanzi } = DATA[idx];

      const order = shuffleBank ? shuffle([...hanzi.keys()]) : [...hanzi.keys()];
      order.forEach(ti=>{
        bankZone.appendChild(createToken(idx, ti));
      });

      // æ‹¼éŸ³é¡¯ç¤ºç‹€æ…‹
      document.body.classList.toggle('show-pinyin', showPinyin);
    }

    // æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer(){
      const target = DATA[current].hanzi.join('');
      const built = [...answerZone.querySelectorAll('.token')].map(el=>el.dataset.hanzi).join('');
      if (built === target){
        statusEl.textContent = 'âœ… æ­£ç¢ºï¼åšå¾—å¥½ï½';
        statusEl.className = 'status ok';
      } else {
        statusEl.textContent = 'âš ï¸ é‚„å·®ä¸€é»é»ï¼Œå†èª¿æ•´çœ‹çœ‹ï¼';
        statusEl.className = 'status err';
      }
    }

    // ---- DnD å€åŸŸï¼ˆç­”æ¡ˆ / è©åº«ï¼‰è¡Œç‚º
    [answerZone, bankZone].forEach(zone=>{
      zone.addEventListener('dragover', e=>{
        e.preventDefault();
        zone.classList.add('drop-hover');

        // å…è¨±åœ¨ç­”æ¡ˆå€å…§éƒ¨ã€Œæ’å…¥åˆ°æŸ token å‰ã€
        const afterEl = getDragAfterElement(zone, e.clientX, e.clientY);
        const draggingId = e.dataTransfer?.getData('text/plain');
        const dragging = draggingId ? document.querySelector(`[data-token-id="${draggingId}"]`) : null;
        if (afterEl == null) {
          // no specific target, show as append (visual only)
        } else {
          // visual hint handled by CSS gap
        }
      });

      zone.addEventListener('dragleave', ()=> zone.classList.remove('drop-hover'));

      zone.addEventListener('drop', e=>{
        e.preventDefault();
        zone.classList.remove('drop-hover');
        const id = e.dataTransfer.getData('text/plain');
        const token = document.querySelector(`[data-token-id="${id}"]`);
        if (!token) return;

        // åœ¨æ¸¸æ¨™ä½ç½®å‰æ’å…¥
        const afterEl = getDragAfterElement(zone, e.clientX, e.clientY);
        if (afterEl == null) zone.appendChild(token);
        else zone.insertBefore(token, afterEl);
      });
    });

    // æ‰¾åˆ°æ¸¸æ¨™ä¹‹å¾Œçš„æœ€è¿‘å…ƒç´ ï¼ˆæ–¹ä¾¿åœ¨ä¸­é–“æ’å…¥ï¼‰
    function getDragAfterElement(container, x, y){
      const els = [...container.querySelectorAll('.token:not(.dragging)')];
      return els.reduce((closest, child)=>{
        const rect = child.getBoundingClientRect();
        // è¨ˆç®—æ»‘é¼ åˆ°å…ƒç´ ä¸­å¿ƒçš„è·é›¢
        const offset = Math.hypot(x - (rect.left+rect.width/2), y - (rect.top+rect.height/2));
        if (offset < closest.offset) return { offset, element: child };
        else return closest;
      }, { offset: Number.POSITIVE_INFINITY, element: null }).element;
    }

    // äº‹ä»¶ç¶å®š
    togglePinyin.addEventListener('change', ()=>{
      showPinyin = togglePinyin.checked;
      document.body.classList.toggle('show-pinyin', showPinyin);
    });

    btnShuffle.addEventListener('click', ()=> loadSentence(current, true));
    btnReset.addEventListener('click', ()=> loadSentence(current, false));
    btnCheck.addEventListener('click', checkAnswer);
    btnNext.addEventListener('click', ()=>{
      const next = (current + 1) % DATA.length;
      loadSentence(next, true);
    });

    selectEl.addEventListener('change', e=> loadSentence(Number(e.target.value), true));

    // å•Ÿå‹•
    (function start(){
      initSelect();
      loadSentence(0, true);
    })();
  </script>
</body>
</html>
